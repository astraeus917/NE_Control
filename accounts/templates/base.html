{% load static %}
<!DOCTYPE html>
<html lang="pt_BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock %}</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

    <!-- Pop-up de alertas do site -->
    {% if messages %}
        <div id="messages-container" class="fixed top-5 right-5 space-y-2 z-50">
            {% for msg in messages %}
                <div class="popup-message px-4 py-2 rounded shadow-md transition-opacity duration-500
                    {% if msg.tags == 'success' %}bg-green-500 text-white
                    {% elif msg.tags == 'error' %}bg-red-500 text-white
                    {% elif msg.tags == 'warning' %}bg-yellow-500 text-black
                    {% elif msg.tags == 'info' %}bg-blue-500 text-white
                    {% else %}bg-gray-500 text-white{% endif %}">
                    {{ msg }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Menu de navegação do site -->
    <nav>
        <ul>
            <li><a href="{% url 'control' %}">Minhas NEs</a></li>
            <li><a href="{% url 'list' %}">Todas as NEs</a></li>
            {% if user.role == 'admin' %}
                <li><a href="{% url 'manage' %}">Gestão</a></li>
                <li><a href="{% url 'admin:index' %}">Administração</a></li>
            {% endif %}
            <li><a href="{% url 'logout' %}">Sair</a></li>
        </ul>
    </nav>

    <!-- Conteúdo do Sistema -->
    {% block content %}{% endblock %}

<!-- Scripts JS -->
<script>
    // Função para esconder todos os pop-ups após 3 segundos.
    function hidePopupsAfterDelay() {
        setTimeout(() => {
            document.querySelectorAll(".popup-message").forEach(el => {
                el.classList.add("opacity-0");
                setTimeout(() => el.remove(), 500);
            });
        }, 3000);
    }

    // Função para ativar a pesquisa dinâmica na tabela.
    function enableSearch(inputId, targetSelector) {
        const searchInput = document.getElementById(inputId);

        if (!searchInput) return;

        searchInput.addEventListener("input", function () {
            const term = this.value.toLowerCase();
            const lines = document.querySelectorAll(targetSelector);

            lines.forEach(line => {
                const text = line.textContent.toLowerCase();
                line.style.display = text.includes(term) ? "" : "none";
            });
        });
    }

    // Função para simular um acordeon.
    function toggleAccordion(id) {
        const content = document.getElementById(id);
        const icon = document.getElementById('icon-' + id);

        if (content.classList.contains('hidden')) {
            content.classList.remove('hidden');
            icon.classList.add('rotate-180');
        } else {
            content.classList.add('hidden');
            icon.classList.remove('rotate-180');
        }
    }

    // Executando as funções.
    hidePopupsAfterDelay();
    enableSearch("search", ".table-line");
</script>
</body>
</html>